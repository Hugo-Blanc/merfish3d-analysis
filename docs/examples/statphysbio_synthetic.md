# StatPhysBio synthetic data example

## Overview

The goal of this example is to retrieve a simulated 3D MERFISH experiment generated by the [statphysbio lab](https://labpresse.com/) at ASU and run `merfish3d-analysis`. This is a synthetic 119-gene MERFISH experiment in a small field of view (FOV).

## Preliminaries

You need to make sure you have a working python enviornment with `merfish3d-analysis` properly installed and the synthetic dataset downloaded. The dataset is ~20 MB and you will need roughly another 20 MB of temporary space to create the `qi2labDataStore` structure we use to perform tile registration, pixel decoding, filtering, and cell assignment.

- [merfish3d-analysis](https://www.github.com/qi2lab/merfish3d-analysis)
- [Synthetic 3D MERFISH data]([https://drive.google.com/file/d/12D0VjfFSGjTsUAJdM0DUTvIdU0ReNGgG/view?usp=drive_link](https://zenodo.org/records/17274305/files/merfish3d_analysis-simulation.zip?download=1))

## Downloading the data

The Zenodo link contains four types of simulations: (1) MERFISH in cells; (2) MERFISH randomly distributed; (3) smFISH in cells; (4) smFISH randomly distributed. For each simulation type, there are three axial spacings: 0.315, 1.0, and 1.5 micrometers. The directory structure is as follows:

```bash
/path/to/download/
├── example_16bit_cells/
  ├── 0.315/
    ├── beads
        ├── codebook.csv
        └── experiment_and_GT.h5
    ├── aligned_1.tif
    ├── bit_order.csv
    ├── codebook.csv
    ├── GT_spots.csv
    ├── experiment_and_GT.h5
    ├── norm_offset.json
    └── scan_metadata.csv
  ├── 1.0/
    ├── beads/
        ├── codebook.csv
        └── experiment_and_GT.h5
    ├── aligned_1.tif
    ├── bit_order.csv
    ├── codebook.csv
    ├── GT_spots.csv
    ├── experiment_and_GT.h5
    ├── norm_offset.json
    └── scan_metadata.csv
  ├── 1.5/
    ├── beads/
        ├── codebook.csv
        └── experiment_and_GT.h5
    ├── aligned_1.tif
    ├── bit_order.csv
    ├── codebook.csv
    ├── GT_spots.csv
    ├── experiment_and_GT.h5
    ├── norm_offset.json
    └── scan_metadata.csv
├── example_16bit_uniform/
...
```

## Processing non-qi2lab data

Because this is a simulated experiment, it does not follow the standard metadata or file structure of a microscope. Because of the difference, we first simulate an qi2lab experiment using the synthetic data and proceed from there.

## Processing steps

We provide a command line interface (CLI) to run the simulation analysis. This consists of a series of commands for each processing step.

1. Simulation conversion
```bash
sim-convert /path/to/simulation/example_16bit_cells/0.315
```
2. Simulation to qi2lab datastore conversion
```bash
sim-datastore /path/to/simulation/example_16bit_cells/0.315
```
3. Data pre-processing
```bash
sim-preprocess /path/to/simulation/example_16bit_cells/0.315
```
4. Pixel decoding and RNA calling
```bash
sim-decode /path/to/simulation/example_16bit_cells/0.315
```
5. Calculate F1-score
```bash
sim-f1score /path/to/simulation/example_16bit_cells/0.315
```

## Ensuring a sucessful run

If the runs are succesful, you should have F1 scores that match the following values:


